<odoo>

	<template id="portal_invoice_make_deposit" name="Invoice Make Deposit">
        <div class="row" t-if="not tx_ids and invoice.state == 'draft' and invoice.invoice_payment_state == 'not_paid' and invoice.deposit_amount" id="portal_pay_deposit">
            <div class="modal fade" id="pay_with_deposit" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title">Pay with</h3>
                            <button type="button" class="close" data-dismiss="modal">&amp;times;</button>
                        </div>
                        <div class="modal-body">
                            <div t-if="pms or acquirers" id="payment_method" class="text-left col-md-13">
                                <t t-call="payment.payment_tokens_list">
                                    <t t-set="mode" t-value="'payment'"/>
                                    <t t-set="partner_id" t-value="invoice.partner_id.id if request.env.user._is_public() else request.env.user.partner_id.id"/>
                                    <t t-set="success_url" t-value="invoice.get_portal_url()"/>
                                    <t t-set="error_url" t-value="invoice.get_portal_url()"/>
                                    <t t-set="access_token" t-value="access_token or ''"/>
                                    <t t-set="callback_method" t-value="''"/>
                                    <t t-set="form_action" t-value="'/invoice/pay_deposit/' + str(invoice.id) + '/s2s_token_tx/'"/>
                                    <t t-set="prepare_tx_url" t-value="'/invoice/pay_deposit/' + str(invoice.id) + '/form_tx/'"/>
                                    <t t-set="submit_txt">Pay Now</t>
                                    <t t-set="icon_class" t-value="'fa-lock'"/>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>
    
    <template id="portal_make_deposit" name="Make Deposit" inherit_id="account_payment.portal_invoice_page_inherit_payment">
        <xpath expr="//div/a[@data-target='#pay_with']" position="before">
        	<t t-if="invoice.state == 'draft' and invoice.invoice_payment_state == 'not_paid' and invoice.deposit_amount and not invoice.deposit_exist and invoice.type == 'out_invoice'">
        		<b> Deposit Amount: <t t-esc="'%.2f' % (invoice.deposit_amount)"/> </b>
        	</t>
        	<br/>
            <a href="#" t-if="invoice.state == 'draft' and invoice.invoice_payment_state == 'not_paid' and invoice.deposit_amount and not invoice.deposit_exist and invoice.type == 'out_invoice' and (pending_manual_txs or not tx_ids)"
                class="btn btn-primary btn-block mb-2" data-toggle="modal" data-target="#pay_with_deposit">
                <i class="fa fa-fw fa-arrow-circle-right"/> Make Deposit
            </a>
        </xpath>
        
        <xpath expr="//div[@id='portal_pay']" position="before">
            <div t-if="not tx_ids and invoice.state == 'draft' and invoice.invoice_payment_state == 'not_paid' and invoice.deposit_amount" id="portal_pay_deposit">
                <div t-if="pms or acquirers" id="payment_method_deposit">
                    <t t-call="bt_invoice_deposit.portal_invoice_make_deposit"/>
                </div>
            </div>
        </xpath>
    </template>
    
    <template id="portal_my_invoices_payment_make_deposit" name="Payment on My Invoices Make Deposit" inherit_id="account_payment.portal_my_invoices_payment">
        <xpath expr="//td[@class='tx_status text-center']" position="inside">
        	<t t-if="invoice.deposit_exist">
                <span class="badge badge-pill badge-primary"><i class="fa fa-fw fa-check"/><span class="d-none d-md-inline"> Deposit Received</span></span>
            </t>
        </xpath>
    </template>
    
    
     <template id="portal_my_home_menu_draft_invoice" name="Portal layout : draft invoice menu entries" inherit_id="portal.portal_breadcrumbs" priority="31">
        <xpath expr="//ol[hasclass('o_portal_submenu')]" position="inside">
            <li t-if="page_name == 'daftinvoice'" t-attf-class="breadcrumb-item #{'active ' if not draftinvoice else ''}">
                <a t-if="draftinvoice" t-attf-href="/my/draftinvoices?{{ keep_query() }}">Draft Invoices</a>
                <t t-else="">Draft Invoices</t>
            </li>
            <li t-if="draftinvoice" class="breadcrumb-item active">
                <t t-esc="draftinvoice.name" t-if="draftinvoice.name"/>
                <t t-else=""><em>Draft Invoice</em></t>
            </li>
        </xpath>
    </template>
    
    <template id="portal_my_home_draft_invoice" name="Portal My Home : draft invoice entries" inherit_id="portal.portal_my_home" priority="31">
        <xpath expr="//div[hasclass('o_portal_docs')]" position="inside">
            <t t-if="draftinvoice_count" t-call="portal.portal_docs_entry">
                <t t-set="title">Draft Invoices</t>
                <t t-set="url" t-value="'/my/draftinvoices'"/>
                <t t-set="count" t-value="draftinvoice_count"/>
            </t>
        </xpath>
    </template>
    
    <template id="portal_my_draftinvoices" name="Draft Invoices">
      <t t-call="portal.portal_layout">
        <t t-set="breadcrumbs_searchbar" t-value="True"/>

        <t t-call="portal.portal_searchbar">
            <t t-set="title">Draft Invoices</t>
        </t>
        <t t-if="not invoices">
            <p>There are currently no draft invoices for your account.</p>
        </t>
        <t t-if="invoices" t-call="portal.portal_table">
            <thead>
                <tr class="active">
                    <th>Invoice #</th>
                    <th>Invoice Date</th>
                    <th class='d-none d-md-table-cell'>Due Date</th>
                    <th/>
                    <th class="text-right">Amount Due</th>
                </tr>
            </thead>
            <tbody>
                <t t-foreach="invoices" t-as="invoice">
                    <tr>
                        <td>
                            <a t-att-href="invoice.get_portal_url()" t-att-title="invoice.name">
                                <t t-esc="invoice.name" t-if="invoice.name"/>
                                <em t-else="">Draft Invoice</em>
                            </a>
                        </td>
                        <td><span t-field="invoice.invoice_date"/></td>
                        <td class='d-none d-md-table-cell'><span t-field="invoice.invoice_date_due"/></td>
                        <td class="tx_status">
                        	<t t-if="invoice.deposit_exist">
				                <span class="badge badge-pill badge-primary"><i class="fa fa-fw fa-check"/><span class="d-none d-md-inline"> Deposit Received</span></span>
				            </t>
                            <t t-if="invoice.state == 'open'">
                                <span class="badge badge-pill badge-info"><i class="fa fa-fw fa-clock-o" aria-label="Opened" title="Opened" role="img"></i><span class="d-none d-md-inline"> Waiting for Payment</span></span>
                            </t>
                            <t t-if="invoice.state == 'paid'">
                                <span class="badge badge-pill badge-success"><i class="fa fa-fw fa-check" aria-label="Paid" title="Paid" role="img"></i><span class="d-none d-md-inline"> Paid</span></span>
                            </t>
                            <t t-if="invoice.state == 'cancel'">
                                <span class="badge badge-pill badge-warning"><i class="fa fa-fw fa-remove" aria-label="Cancelled" title="Cancelled" role="img"></i><span class="d-none d-md-inline"> Cancelled</span></span>
                            </t>
                        </td>
                        <td class="text-right"><span t-esc="-invoice.amount_residual if invoice.type == 'out_refund' else invoice.amount_residual" t-options='{"widget": "monetary", "display_currency": invoice.currency_id}'/></td>
                    </tr>
                </t>
            </tbody>
        </t>
      </t>
    </template>


</odoo>
